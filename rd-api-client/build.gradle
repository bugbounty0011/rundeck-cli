import java.text.SimpleDateFormat

buildscript {
    repositories {
        jcenter()
    }
}
plugins{
    id "java-library"
    id "org.dvaske.gradle.git-build-info" version "0.8"
    id 'de.fuerstenau.buildconfig' version '1.1.8'
    id 'maven-publish'
}




apply plugin: 'idea'
apply plugin: 'groovy'
apply plugin: 'de.fuerstenau.buildconfig'

group = 'org.rundeck.api'

/**
 * Generates java source with embedded version info
 */
buildConfig {
    clsName = 'Version'
    packageName = 'org.rundeck.client'
    buildConfigField 'String', 'GIT_COMMIT', {
        project.gitCommit
    }
    buildConfigField 'String', 'GIT_BRANCH', {
        project.gitBranch
    }
    buildConfigField 'String', 'GIT_DESCRIPTION', {
        project.gitDescribeInfo
    }
    buildConfigField 'String', 'BUILD_DATE', {
        new SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ssX").format(new Date())
    }

}


dependencies {

    compileOnly "org.projectlombok:lombok:${lombokVersion}"
    annotationProcessor "org.projectlombok:lombok:${lombokVersion}"

    api "com.squareup.retrofit2:retrofit:${retrofitVersion}"
    api "com.squareup.retrofit2:converter-jackson:${retrofitVersion}"
    api "com.squareup.retrofit2:converter-jaxb:${retrofitVersion}"
    api "com.squareup.okhttp3:logging-interceptor:${okhttpVersion}"
    api "com.squareup.okhttp3:okhttp-urlconnection:${okhttpVersion}"
    api 'com.sun.xml.bind:jaxb-impl:2.3.3'


    testImplementation group: 'junit', name: 'junit', version: '4.12'
    testImplementation "com.squareup.retrofit2:retrofit-mock:${retrofitVersion}"
    testImplementation "com.squareup.okhttp3:mockwebserver:${okhttpVersion}"
    testImplementation "org.codehaus.groovy:groovy-all:2.5.7"
    testImplementation "org.spockframework:spock-core:1.3-groovy-2.5"
}


java {
    withJavadocJar()
    withSourcesJar()
}

publishing {
    publications {
        rdApiClientPublication(MavenPublication) {
            from components.java

            pom {
                name = "Rundeck API Library ${project.version}"
                description = project.description ?: 'Rundeck API Library'
                url = 'https://github.com/rundeck/rundeck-cli'
                licenses {
                    license {
                        name= 'The Apache Software License, Version 2.0'
                        url ='http://www.apache.org/licenses/LICENSE-2.0.txt'
                        distribution= 'repo'
                    }
                }
                scm {
                    url ='https://github.com/rundeck/rundeck-cli'
                    connection= 'scm:git:git@github.com/rundeck/rundeck-cli.git'
                    developerConnection= 'scm:git:git@github.com:rundeck/rundeck-cli.git'
                }
                developers {
                    developer {
                        id='gschueler'
                        name='Greg Schueler'
                        email='greg@rundeck.com'
                    }
                }
            }

        }
    }
}
